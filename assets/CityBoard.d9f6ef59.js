import{d as x,j as C,a as R,l as b,k as g,w as _,b as l,c,f as d,e as S,n as v,h,g as F,F as p,p as w,x as B,H as N,q as T,t as A,I as O,u as $,s as P,o as L}from"./index.1fde3d96.js";import{I}from"./IconSearch.11597886.js";import{_ as K,a as Z}from"./RouteDetail.c44eb48e.js";import{b as E}from"./api.89715e17.js";import{u as z}from"./bus.366bf9c7.js";import"./map.cb522d94.js";const U={class:"flex h-full w-full flex-col"},q={class:"flex-c h-[4rem] flex-grow bg-white px-4"},J={class:"relative w-full rounded-lg bg-gray-300"},V=["placeholder"],W={class:"h-[calc(100%-22rem)] overflow-y-scroll bg-white px-4 pb-4"},j={class:"flex-c h-[16rem] flex-col bg-gray-100 p-4"},M=["onClick"],H=x({__name:"RouteLists",props:{city:null,data:null},emits:["showDetail"],setup(k){const n=k,{t:u}=C(),y=R(),r={Taipei:[{text:["buttonBoard.red","buttonBoard.blue",1,2,3],color:["#E87E7E","#3591C5"]},{text:["buttonBoard.green","buttonBoard.brown",4,5,6],color:["#5CC1A9","#A86556"]},{text:["buttonBoard.orange","buttonBoard.small",7,8,9],color:["#EEA12E","#DEBE4E"]},{text:["buttonBoard.F","buttonBoard.metro",0,"buttonBoard.clean"],color:["#888888","#888888"]}],Taoyuan:[{text:[1,2,3],color:[]},{text:[4,5,6],color:[]},{text:[7,8,9],color:[]},{text:["buttonBoard.L",0,"buttonBoard.clean"],color:["#DEBE4E"]}],Tainan:[{text:["buttonBoard.red","buttonBoard.blue",1,2,3],color:["#E87E7E","#3591C5"]},{text:["buttonBoard.green","buttonBoard.brown",4,5,6],color:["#5CC1A9","#A86556"]},{text:["buttonBoard.orange","buttonBoard.yellow",7,8,9],color:["#EEA12E","#DEBE4E"]},{text:[0,"buttonBoard.clean"],color:[]}],Kaohsiung:[{text:["buttonBoard.red",1,2,3],color:["#E87E7E"]},{text:["buttonBoard.orange",4,5,6],color:["#EEA12E"]},{text:["buttonBoard.yellow",7,8,9],color:["#DEBE4E"]},{text:["buttonBoard.JOY","buttonBoard.express",0,"buttonBoard.clean"],color:["#283C43","#283C43"]}],Other:[{text:[1,2,3],color:[]},{text:[4,5,6],color:[]},{text:[7,8,9],color:[]},{text:[0,"buttonBoard.clean"],color:[]}]},a=b({keyParamFirst:"",keyParamLast:"",keyword:"",keyboard:g(()=>n.city&&Object.prototype.hasOwnProperty.call(r,n.city)?r[n.city]:r.Other),data:g(()=>{const t=n.data;if(!t||t.length===0)return[];let e;return y.lang==="zh-TW"?e=t.filter(o=>o.RouteName.Zh_tw.indexOf(a.keyword)>=0):e=t.filter(o=>o.RouteName.En?o.RouteName.En.indexOf(a.keyword)>=0:o.RouteName.Zh_tw.indexOf(a.keyword)>=0),e}),changeKeyByButton(t){t==="\u6E05\u9664"||t==="Clean"?(this.keyParamFirst="",this.keyParamLast=""):isNaN(Number(t))?this.keyParamFirst=t.toString():this.keyParamLast+=t,this.keyword=this.keyParamFirst+this.keyParamLast},reset(){this.keyParamFirst="",this.keyParamLast="",this.keyword=""}}),s=g(()=>{const t=n.data;return!t||t.length===0?[]:y.lang==="zh-TW"?t.filter(e=>e.RouteName.Zh_tw.indexOf(a.keyword)>=0):t.filter(e=>e.RouteName.En?e.RouteName.En.indexOf(a.keyword)>=0:e.RouteName.Zh_tw.indexOf(a.keyword)>=0)});return _(()=>n.city,()=>{a.reset()}),(t,e)=>(l(),c("section",U,[d("div",q,[d("div",J,[S(d("input",{id:"bus-filter","onUpdate:modelValue":e[0]||(e[0]=o=>a.keyword=o),type:"search",name:"bus-filter",placeholder:h(u)("typeKeyword"),class:"peer w-full border-0 bg-transparent focus:ring-0"},null,8,V),[[v,a.keyword]]),F(I,{class:"absolute right-3 top-[50%] h-4 w-4 -translate-y-[50%] peer-hover:hidden peer-focus:hidden"})])]),d("div",W,[(l(!0),c(p,null,w(h(s),o=>(l(),B(K,{key:o.RouteUID,data:o,onClick:m=>t.$emit("showDetail",o)},null,8,["data","onClick"]))),128))]),d("div",j,[(l(!0),c(p,null,w(a.keyboard,(o,m)=>(l(),c("ul",{key:m,class:"mb-2 flex w-full gap-2 last:mb-0"},[(l(!0),c(p,null,w(o.text,(i,f)=>{var D;return l(),c("li",{key:f,style:N(`background-color: ${(D=o.color[f])!=null?D:"#D5D5D5"}`),class:T([{"text-white":o.color[f]},"flex-1 cursor-pointer rounded-lg py-3 text-center hover:ring-1 hover:ring-gray-700 hover:brightness-110"]),onClick:Y=>a.changeKeyByButton(typeof i=="string"?h(u)(i):i.toString())},A(typeof i=="string"?h(u)(i):i.toString()),15,M)}),128))]))),128))])]))}}),at=x({__name:"CityBoard",setup(k){const n=O(),u=$(),y=z(),{currentCity:r}=P(y),a=b({data:[],getRoutesData(){const t=r.value;if(!localStorage.getItem(`${t}Routes`))return this.updateRoutesData();const e=JSON.parse(localStorage.getItem(`${t}Routes`)),o=e.time;if(Date.now()-o>30*24*60*60*1e3)return localStorage.removeItem(`${t}Routes`),this.updateRoutesData();this.data=e.data},async updateRoutesData(){const t=r.value,e=await E.getRoutesData(t);if(!e)return u.error("\u53D6\u5F97\u8CC7\u6599\u5931\u6557\uFF0C\u8ACB\u7A0D\u5F8C\u518D\u8A66");this.data=e;const o={data:e,time:Date.now()};localStorage.setItem(`${t}Routes`,JSON.stringify(o))}}),s=b({isShow:!1,currentRoute:{},data:{go:[],back:[],circle:[]},async show(t){const e=await E.getRouteWithArrivalTime(t.City,t.RouteName.Zh_tw);e?(s.data=e,s.currentRoute=t,s.isShow=!0):u.error("\u53D6\u5F97\u8CC7\u6599\u5931\u6557\uFF0C\u8ACB\u7A0D\u5F8C\u518D\u8A66")}});return L(()=>{if(n.query.city){const t=["Taipei","Taoyuan","Taichung","Tainan","Kaohsiung"],e=n.query.city.toString();t.includes(e)&&(r.value=e)}!r.value||a.getRoutesData()}),_(r,()=>{r.value&&(a.getRoutesData(),s.isShow=!1)}),(t,e)=>s.isShow?(l(),B(Z,{key:1,route:s.currentRoute,data:s.data,onUpdateDetail:s.show,onCloseDetail:e[0]||(e[0]=o=>s.isShow=!1)},null,8,["route","data","onUpdateDetail"])):(l(),B(H,{key:0,city:h(r),data:a.data,onShowDetail:s.show},null,8,["city","data","onShowDetail"]))}});export{at as default};
