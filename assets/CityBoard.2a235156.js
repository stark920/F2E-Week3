import{d as I,h as L,u as Z,p as N,m as R,w as W,a as u,c as b,b as o,q as U,v as K,f as l,e as P,F as C,x as T,i as S,B as V,n as F,t as d,s as A,k as $,o as j,C as H,j as B,y as q,D as J,l as Y}from"./index.b6f8b307.js";import{I as G,a as Q,c as X,b as z}from"./api.88fc61ba.js";import{_ as tt}from"./RouteCard.623ce9d8.js";import{u as et,I as ot,a as at}from"./likes.e03c4d1d.js";import{u as rt}from"./map.2d1af196.js";import{u as nt}from"./bus.5eea2a3f.js";const st={class:"flex h-full w-full flex-col"},it={class:"flex-c h-[4rem] flex-grow bg-white px-4"},lt={class:"relative w-full rounded-lg bg-gray-300"},ut=["placeholder"],ct={class:"h-[calc(100%-22rem)] overflow-y-scroll bg-white px-4 pb-4"},dt={class:"flex-c h-[16rem] flex-col bg-gray-100 p-4"},ht=["onClick"],mt=I({__name:"RouteLists",props:{city:null,data:null},emits:["showDetail"],setup(a){const h=a,{t:f}=L(),c=Z(),m={Taipei:[{text:["buttonBoard.red","buttonBoard.blue",1,2,3],color:["#E87E7E","#3591C5"]},{text:["buttonBoard.green","buttonBoard.brown",4,5,6],color:["#5CC1A9","#A86556"]},{text:["buttonBoard.orange","buttonBoard.small",7,8,9],color:["#EEA12E","#DEBE4E"]},{text:["buttonBoard.F","buttonBoard.metro",0,"buttonBoard.clean"],color:["#888888","#888888"]}],Taoyuan:[{text:[1,2,3],color:[]},{text:[4,5,6],color:[]},{text:[7,8,9],color:[]},{text:["buttonBoard.L",0,"buttonBoard.clean"],color:["#DEBE4E"]}],Tainan:[{text:["buttonBoard.red","buttonBoard.blue",1,2,3],color:["#E87E7E","#3591C5"]},{text:["buttonBoard.green","buttonBoard.brown",4,5,6],color:["#5CC1A9","#A86556"]},{text:["buttonBoard.orange","buttonBoard.yellow",7,8,9],color:["#EEA12E","#DEBE4E"]},{text:[0,"buttonBoard.clean"],color:[]}],Kaohsiung:[{text:["buttonBoard.red",1,2,3],color:["#E87E7E"]},{text:["buttonBoard.orange",4,5,6],color:["#EEA12E"]},{text:["buttonBoard.yellow",7,8,9],color:["#DEBE4E"]},{text:["buttonBoard.JOY","buttonBoard.express",0,"buttonBoard.clean"],color:["#283C43","#283C43"]}],Other:[{text:[1,2,3],color:[]},{text:[4,5,6],color:[]},{text:[7,8,9],color:[]},{text:[0,"buttonBoard.clean"],color:[]}]},i=N({keyParamFirst:"",keyParamLast:"",keyword:"",keyboard:R(()=>h.city&&Object.prototype.hasOwnProperty.call(m,h.city)?m[h.city]:m.Other),data:R(()=>{const e=h.data;if(!e||e.length===0)return[];let t;return c.lang==="zh-TW"?t=e.filter(r=>r.RouteName.Zh_tw.indexOf(i.keyword)>=0):t=e.filter(r=>r.RouteName.En?r.RouteName.En.indexOf(i.keyword)>=0:r.RouteName.Zh_tw.indexOf(i.keyword)>=0),t}),changeKeyByButton(e){e==="\u6E05\u9664"||e==="Clean"?(this.keyParamFirst="",this.keyParamLast=""):isNaN(Number(e))?this.keyParamFirst=e.toString():this.keyParamLast+=e,this.keyword=this.keyParamFirst+this.keyParamLast},reset(){this.keyParamFirst="",this.keyParamLast="",this.keyword=""}}),g=R(()=>{const e=h.data;return!e||e.length===0?[]:c.lang==="zh-TW"?e.filter(t=>t.RouteName.Zh_tw.indexOf(i.keyword)>=0):e.filter(t=>t.RouteName.En?t.RouteName.En.indexOf(i.keyword)>=0:t.RouteName.Zh_tw.indexOf(i.keyword)>=0)});return W(()=>h.city,()=>{i.reset()}),(e,t)=>(u(),b("section",st,[o("div",it,[o("div",lt,[U(o("input",{id:"bus-filter","onUpdate:modelValue":t[0]||(t[0]=r=>i.keyword=r),type:"search",name:"bus-filter",placeholder:l(f)("typeKeyword"),class:"peer w-full border-0 bg-transparent focus:ring-0"},null,8,ut),[[K,i.keyword]]),P(G,{class:"absolute right-3 top-[50%] h-4 w-4 -translate-y-[50%] peer-hover:hidden peer-focus:hidden"})])]),o("div",ct,[(u(!0),b(C,null,T(l(g),r=>(u(),S(tt,{key:r.RouteUID,data:r,onClick:n=>e.$emit("showDetail",r)},null,8,["data","onClick"]))),128))]),o("div",dt,[(u(!0),b(C,null,T(i.keyboard,(r,n)=>(u(),b("ul",{key:n,class:"mb-2 flex w-full gap-2 last:mb-0"},[(u(!0),b(C,null,T(r.text,(y,x)=>{var k;return u(),b("li",{key:x,style:V(`background-color: ${(k=r.color[x])!=null?k:"#D5D5D5"}`),class:F([{"text-white":r.color[x]},"flex-1 cursor-pointer rounded-lg py-3 text-center hover:ring-1 hover:ring-gray-700 hover:brightness-110"]),onClick:D=>i.changeKeyByButton(typeof y=="string"?l(f)(y):y.toString())},d(typeof y=="string"?l(f)(y):y.toString()),15,ht)}),128))]))),128))])]))}}),gt={class:"relative mx-4 flex items-center justify-between border-b-[1px] border-gray-500 py-4 pr-4 text-center duration-150 hover:bg-gray-300"},ft={class:"flex-c"},yt={key:0,class:"p-1 font-bold text-secondary"},pt=o("div",{class:"absolute right-0 top-1/2 h-full w-[2px] bg-gray-500"},null,-1),bt=o("div",{class:"absolute right-[1px] h-3 w-3 translate-x-1/2 rounded-full bg-gray-500 ring-[2px] ring-white"},null,-1),wt=I({__name:"StopCard",props:{data:null},setup(a){const{t:h}=L(),f=Z(),{lang:c}=A(f);function m(t,r){if(t===-1)return r?i(r):h("noDeparture");if(t<30)return h("arriving");if(t<60)return h("upcoming");{const n=(t/60).toFixed(0);return h("minute",{num:n})}}function i(t){const r=new Date(t),n=r.getHours(),y=r.getMinutes();return`${n<10?"0"+n:n}:${y<10?"0"+y:y}`}function g(t){return t===-1||!t?"bg-gray-500":t<60?"bg-secondary":"bg-primary"}const e=t=>t>=0&&t<30;return(t,r)=>{var n,y,x,k;return u(),b("div",gt,[o("div",ft,[o("div",{class:F([g((n=a.data.EstimateTime)!=null?n:-1),"mr-4 w-[5rem] rounded-lg py-1 text-white"])},d(m((y=a.data.EstimateTime)!=null?y:-1,a.data.NextBusTime)),3),o("div",{class:F({"font-bold":e((x=a.data.EstimateTime)!=null?x:-1)})},d(l(c)==="zh-TW"?a.data.StopName.Zh_tw:(k=a.data.StopName.En)!=null?k:a.data.StopName.Zh_tw),3)]),a.data.PlateNumb?(u(),b("div",yt,d(a.data.PlateNumb),1)):$("",!0),pt,bt])}}}),Dt={class:"flex h-[2rem] items-center justify-between px-2"},xt={class:"ml-1"},kt={class:"flex-c h-[6rem] flex-col"},vt={class:"text-4xl font-bold"},St={class:"flex h-[2rem]"},Et=o("input",{type:"radio",name:"direction",class:"peer hidden",checked:""},null,-1),Ct={class:"cursor-pointer rounded-t-md bg-gray-300 py-2 text-center peer-checked:bg-primary peer-checked:text-white"},Nt=o("input",{type:"radio",name:"direction",class:"peer hidden"},null,-1),Bt={class:"cursor-pointer rounded-t-md bg-gray-300 py-2 text-center peer-checked:bg-primary peer-checked:text-white"},Rt=o("input",{type:"radio",name:"direction",class:"peer hidden",checked:""},null,-1),Tt={class:"cursor-pointer rounded-t-md bg-gray-300 py-2 text-center peer-checked:bg-primary peer-checked:text-white"},$t=o("span",null," | ",-1),Ft={class:"h-[calc(100%-13rem)] overflow-y-scroll pb-8 pt-4"},At={class:"relative mx-4 flex h-[3rem] items-center justify-between"},It={class:"absolute top-0 h-[2px] w-full bg-gray-300"},Pt={class:"flex-c mt-[1px]"},Lt=["checked"],Zt={class:"ml-1"},_t={class:"ml-1"},Mt=I({__name:"RouteDetail",props:{route:null,data:null},emits:["closeDetail","updateDetail"],setup(a,{emit:h}){const f=a,{t:c}=L(),m=Z(),i=et(),g=rt(),{lang:e}=A(m),{likeRoutes:t}=A(i),r=N({timer:30,intervalContainer:void 0,autoMode:!1,toggleAutoMode(){this.autoMode=!this.autoMode,this.autoMode?this.intervalContainer=setInterval(()=>{this.timer-=1,this.timer<0&&(this.timer=30,h("updateDetail",f.route))},1e3):(clearInterval(this.intervalContainer),this.timer=30)}}),n=N({currentDirection:0,data:R(()=>{switch(n.currentDirection){case 0:return f.data.go;case 1:return f.data.back;case 2:return f.data.circle;default:return[]}})});function y(D,s){if(D===-1)return s?x(s):c("noDeparture");if(D<30)return c("arriving");if(D<60)return c("upcoming");{const p=(D/60).toFixed(0);return c("minute",{num:p})}}function x(D){const s=new Date(D),p=s.getHours(),v=s.getMinutes();return`${p<10?"0"+p:p}:${v<10?"0"+v:v}`}const k=()=>{const s=n.data.map(p=>{var E;return{TimeString:y((E=p.EstimateTime)!=null?E:-1,p.NextBusTime),StopName:p.StopName,StopPosition:{PositionLon:p.StopPosition.PositionLon,PositionLat:p.StopPosition.PositionLat}}});g.routeLine=s};return j(()=>{f.data.go.length>0?n.currentDirection=0:f.data.back.length>0?n.currentDirection=1:n.currentDirection=2,k()}),H(()=>{r.intervalContainer&&clearInterval(r.intervalContainer)}),(D,s)=>{var p,v,E,_,M,O;return u(),b(C,null,[o("section",Dt,[o("button",{type:"button",class:"flex-c",onClick:s[0]||(s[0]=w=>D.$emit("closeDetail"))},[P(Q),o("span",xt,d(l(c)("back")),1)]),o("div",{class:"cursor-pointer",onClick:s[1]||(s[1]=w=>l(i).toggleLikeRoutes(a.route))},[l(t).findIndex(w=>w.RouteUID===a.route.RouteUID)>=0?(u(),S(ot,{key:0,class:"h-5 w-5 text-secondary"})):(u(),S(at,{key:1,class:"h-5 w-5"}))])]),o("section",kt,[o("h3",vt,d(l(e)==="zh-TW"?a.route.RouteName.Zh_tw:(p=a.route.RouteName.En)!=null?p:a.route.RouteName.Zh_tw),1),o("small",null,d((v=a.route.RouteName.En)!=null?v:a.route.RouteName.Zh_tw),1)]),o("section",St,[a.data.go.length>0?(u(),b("label",{key:0,class:"flex-grow",onChange:s[2]||(s[2]=w=>n.currentDirection=0)},[Et,o("div",Ct,[B(d(l(c)("goTo"))+" ",1),o("strong",null,d(l(e)==="zh-TW"?a.route.DepartureStopNameZh:(E=a.route.DepartureStopNameEn)!=null?E:a.route.DepartureStopNameZh),1)])],32)):$("",!0),a.data.back.length>0?(u(),b("label",{key:1,class:"flex-grow",onChange:s[3]||(s[3]=w=>n.currentDirection=1)},[Nt,o("div",Bt,[B(d(l(c)("goTo"))+" ",1),o("strong",null,d(l(e)==="zh-TW"?a.route.DestinationStopNameZh:(_=a.route.DestinationStopNameEn)!=null?_:a.route.DestinationStopNameZh),1)])],32)):$("",!0),a.data.circle.length>0?(u(),b("label",{key:2,class:"flex-grow",onChange:s[4]||(s[4]=w=>n.currentDirection=2)},[Rt,o("div",Tt,[o("strong",null,[B(d(l(e)==="zh-TW"?a.route.DepartureStopNameZh:(M=a.route.DepartureStopNameEn)!=null?M:a.route.DepartureStopNameZh)+" ",1),$t,B(" "+d(l(e)==="zh-TW"?a.route.DestinationStopNameZh:(O=a.route.DestinationStopNameEn)!=null?O:a.route.DestinationStopNameZh),1)])])],32)):$("",!0)]),o("section",Ft,[(u(!0),b(C,null,T(n.data,w=>(u(),S(wt,{key:w.StopUID,data:w},null,8,["data"]))),128))]),o("section",At,[o("div",It,[o("div",{class:F(["absolute left-0 h-[2px] bg-primary",{"process-line":r.autoMode}])},null,2)]),o("div",Pt,[o("input",{type:"checkbox",checked:r.autoMode,onChange:s[5]||(s[5]=(...w)=>r.toggleAutoMode&&r.toggleAutoMode(...w))},null,40,Lt),o("span",Zt,d(l(c)("refreshAuto")),1),U(o("span",null,"\uFF08"+d(l(c)("afterTime"))+" "+d(r.timer)+" "+d(l(c)("second"))+"\uFF09",513),[[q,r.autoMode]])]),o("div",{class:"flex-c cursor-pointer",onClick:s[6]||(s[6]=w=>D.$emit("updateDetail",a.route))},[P(X),o("span",_t,d(l(c)("refreshNow")),1)])])],64)}}}),Vt=I({__name:"CityBoard",setup(a){const h=J(),f=Y(),c=nt(),{currentCity:m}=A(c),i=N({data:[],getRoutesData(){const e=m.value;if(!localStorage.getItem(`${e}Routes`))return this.updateRoutesData();const t=JSON.parse(localStorage.getItem(`${e}Routes`)),r=t.time;if(Date.now()-r>30*24*60*60*1e3)return localStorage.removeItem(`${e}Routes`),this.updateRoutesData();this.data=t.data},async updateRoutesData(){const e=m.value,t=await z.getRoutesData(e);if(!t)return f.error("\u53D6\u5F97\u8CC7\u6599\u5931\u6557\uFF0C\u8ACB\u7A0D\u5F8C\u518D\u8A66");this.data=t;const r={data:t,time:Date.now()};localStorage.setItem(`${e}Routes`,JSON.stringify(r))}}),g=N({isShow:!1,currentRoute:{},data:{go:[],back:[],circle:[]},async show(e){const t=await z.getRouteWithArrivalTime(e.City,e.RouteName.Zh_tw);t?(g.data=t,g.currentRoute=e,g.isShow=!0,console.log(t)):f.error("\u53D6\u5F97\u8CC7\u6599\u5931\u6557\uFF0C\u8ACB\u7A0D\u5F8C\u518D\u8A66")}});return j(()=>{if(h.query.city){const e=["Taipei","Taoyuan","Taichung","Tainan","Kaohsiung"],t=h.query.city.toString();e.includes(t)&&(m.value=t)}!m.value||i.getRoutesData()}),W(m,()=>{m.value&&(i.getRoutesData(),g.isShow=!1)}),(e,t)=>g.isShow?(u(),S(Mt,{key:1,route:g.currentRoute,data:g.data,onUpdateDetail:g.show,onCloseDetail:t[0]||(t[0]=r=>g.isShow=!1)},null,8,["route","data","onUpdateDetail"])):(u(),S(mt,{key:0,city:l(m),data:i.data,onShowDetail:g.show},null,8,["city","data","onShowDetail"]))}});export{Vt as default};
