import{_ as C,a as d,c as m,b as t,d as M,u as I,s as k,t as c,f as l,e as b,h as L,n as B,i as $,j as E,k as P,l as Z,r as j,m as z,p as T,o as R,w as W,F as D,q as A,v as U,x as F,y as H}from"./index.b6f8b307.js";import{b as N,I as G,a as O,c as q}from"./api.88fc61ba.js";import{u as V}from"./map.2d1af196.js";import{u as K,I as J,a as Q}from"./likes.e03c4d1d.js";const X={},Y={xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor","stroke-width":"2"},tt=t("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"M3.055 11H5a2 2 0 012 2v1a2 2 0 002 2 2 2 0 012 2v2.945M8 3.935V5.5A2.5 2.5 0 0010.5 8h.5a2 2 0 012 2 2 2 0 104 0 2 2 0 012-2h1.064M15 20.488V18a2 2 0 012-2h3.064M21 12a9 9 0 11-18 0 9 9 0 0118 0z"},null,-1),et=[tt];function at(e,h){return d(),m("svg",Y,et)}var ot=C(X,[["render",at]]);const st={},nt={xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor","stroke-width":"2"},it=t("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"M17.657 16.657L13.414 20.9a1.998 1.998 0 01-2.827 0l-4.244-4.243a8 8 0 1111.314 0z"},null,-1),rt=t("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"M15 11a3 3 0 11-6 0 3 3 0 016 0z"},null,-1),lt=[it,rt];function ct(e,h){return d(),m("svg",nt,lt)}var dt=C(st,[["render",ct]]);const ut={class:"mb-2 flex items-center justify-between"},ht={class:"text-lg font-bold"},mt={class:"flex-c text-gray-600"},ft={class:"whitespace-pre"},gt=M({__name:"NearbyCard",props:{index:null,data:null},emits:["displayDetail"],setup(e,{emit:h}){const w=e,u=V(),x=I(),{lang:v}=k(x),y=(f,r)=>{const o=u.userPosition;if(!o)return"";const s=o[0],a=o[1];if(f==s&&r==a)return 0;{const i=Math.PI*f/180,n=Math.PI*s/180,_=r-a,S=Math.PI*_/180;let g=Math.sin(i)*Math.sin(n)+Math.cos(i)*Math.cos(n)*Math.cos(S);return g>1&&(g=1),g=Math.acos(g),g=g*180/Math.PI,g=g*60*1.1515*1609.344,g.toFixed(0)}},p=(f,r)=>{var o;u.changeViewPosition(f,r),u.focusStopIndex=w.index,h("displayDetail",w.data.StationID,w.data.City,w.data.StationName.Zh_tw,(o=w.data.StationName.En)!=null?o:w.data.StationName.Zh_tw)};return(f,r)=>{var o;return d(),m("div",{class:"cursor-pointer rounded-t-lg border-b-[1px] border-gray-300 p-4 pb-2 hover:bg-gray-100",onClick:r[0]||(r[0]=s=>p(e.data.StationPosition.PositionLat,e.data.StationPosition.PositionLon))},[t("div",ut,[t("div",null,[t("div",ht,c(l(v)==="zh-TW"?e.data.StationName.Zh_tw:(o=e.data.StationName.En)!=null?o:e.data.StationName.Zh_tw),1),t("small",null,c(l(v)==="zh-TW"?`${e.data.StopsNum} \u500B\u7AD9\u724C`:`${e.data.StopsNum} stops`),1)]),t("div",mt,[b(dt,{class:"m-5 mr-1 h-5"}),t("span",ft,c(`${y(e.data.StationPosition.PositionLat,e.data.StationPosition.PositionLon)} m`),1)])])])}}}),wt={},_t={xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor","stroke-width":"2"},vt=t("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"M9 20l-5.447-2.724A1 1 0 013 16.382V5.618a1 1 0 011.447-.894L9 7m0 13l6-3m-6 3V7m6 10l4.553 2.276A1 1 0 0021 18.382V7.618a1 1 0 00-.553-.894L15 4m0 13V4m0 0L9 7"},null,-1),xt=[vt];function yt(e,h){return d(),m("svg",_t,xt)}var pt=C(wt,[["render",yt]]);const bt={class:"flex items-center rounded-t-lg border-b-[1px] border-gray-500 px-2 py-4 duration-150 hover:bg-gray-300"},St={class:"flex-1"},kt={class:"flex items-center justify-between"},$t={class:"flex-c"},Dt={class:"text-lg font-bold"},Nt=["href"],Ct={class:"flex items-center justify-between"},Mt={class:"text-gray-600"},It={key:0,class:"ml-1 whitespace-nowrap rounded-md bg-blue p-1 text-white"},Pt={key:1,class:"ml-1 whitespace-nowrap rounded-md bg-dark-green p-1 text-white"},Tt={class:"text-gray-600"},At=M({__name:"NearbyDetail",props:{data:null},setup(e){const h=I(),w=K(),{t:u}=L(),{lang:x}=k(h),{likeStops:v}=k(w);function y(r,o){if(r===-1)return o?p(o):u("noDeparture");if(r<30)return u("arriving");if(r<60)return u("upcoming");{const s=(r/60).toFixed(0);return u("minute",{num:s})}}function p(r){const o=new Date(r),s=o.getHours(),a=o.getMinutes();return`${s<10?"0"+s:s}:${a<10?"0"+a:a}`}function f(r){return r===-1||!r?"bg-gray-500":r<60?"bg-secondary":"bg-primary"}return(r,o)=>{var s,a;return d(),m("div",bt,[t("div",{class:B([f(e.data.EstimateTime),"mr-4 w-[4rem] rounded-lg py-1 text-center text-white"])},c(y(e.data.EstimateTime,e.data.NextBusTime)),3),t("div",St,[t("div",kt,[t("div",$t,[t("span",Dt,c(l(x)==="zh-TW"?e.data.RouteName.Zh_tw:(s=e.data.RouteName.En)!=null?s:e.data.RouteName.Zh_tw),1),t("a",{href:e.data.RouteMapImageUrl,alt:"Route Map Image",target:"_blank"},[b(pt,{class:"mx-1 h-5 w-5"})],8,Nt)]),t("div",{class:"cursor-pointer",onClick:o[0]||(o[0]=i=>l(w).toggleLikeStops(e.data))},[l(v).findIndex(i=>i.RouteUID===e.data.RouteUID)>=0?(d(),$(J,{key:0,class:"h-5 w-5 text-secondary"})):(d(),$(Q,{key:1,class:"h-5 w-5"}))])]),t("div",Ct,[t("div",Mt,[E(c(l(u)("goTo"))+" "+c(l(x)==="zh-TW"?e.data.DestinationStopNameZh:(a=e.data.DestinationStopNameEn)!=null?a:e.data.DestinationStopNameZh)+" ",1),e.data.PlateNumb?(d(),m("span",It,c(e.data.PlateNumb),1)):P("",!0),e.data.IsLastBus?(d(),m("span",Pt,c(l(u)("lastBus")),1)):P("",!0)]),t("div",Tt,c(l(u)(`city.${e.data.City}`)),1)])])])}}}),Ft={key:0,class:"flex-c h-full text-gray-400"},Lt={key:1,class:"flex h-full w-full flex-col"},Bt={class:"flex-c h-[4rem] flex-grow bg-white px-4"},Et={class:"relative w-full rounded-lg bg-gray-300"},Vt=["placeholder"],Zt={class:"h-[calc(100%-4rem)] overflow-y-scroll bg-white px-4 pb-4"},jt={key:1,class:"h-full bg-white"},zt={class:"flex h-[2rem] items-center justify-between px-2"},Rt={class:"ml-1"},Wt={class:"flex-c h-[6rem] px-4 text-2xl font-bold"},Ut={class:"flex h-[calc(100%-11rem)] flex-col overflow-y-auto px-4"},Ht={class:"relative mx-4 flex h-[3rem] items-center justify-between"},Gt={class:"absolute top-0 h-[2px] w-full bg-gray-300"},Ot={class:"flex-c mt-[1px]"},qt=["checked"],Kt={class:"ml-1"},Jt={class:"ml-1"},ee=M({__name:"NearbyBoard",setup(e){const{t:h}=L(),w=Z(),u=V(),x=I(),{userPosition:v,nearbyStation:y}=k(u),{lang:p}=k(x),f=j(""),r=z(()=>y.value?y.value.filter(a=>{if(a.StationName.Zh_tw.indexOf(f.value)>=0||a.StationName.En&&a.StationName.En.indexOf(f.value)>=0)return a}):[]),o=T({isShow:!1,name:"",nameEn:"",data:[],async show(a,i,n,_){const S=await N.getNearbyStationWithArrival(a,i);S?(s.currentID=a,s.currenCity=i,this.name=n,this.nameEn=_,this.data=S,this.isShow=!0):w.error("\u7121\u6CD5\u53D6\u5F97\u8CC7\u6599\uFF0C\u8ACB\u7A0D\u5F8C\u518D\u8A66")},closeShow(){s.intervalContainer&&clearInterval(s.intervalContainer),this.isShow=!1}}),s=T({currentID:"",currenCity:"",timer:30,intervalContainer:void 0,autoMode:!1,toggleAutoMode(){this.autoMode=!this.autoMode,this.autoMode?this.intervalContainer=setInterval(()=>{this.timer-=1,this.timer<0&&(this.timer=30,this.updateData())},1e3):(clearInterval(this.intervalContainer),this.timer=30)},async updateData(){if(!this.currentID||!this.currenCity)return;const a=await N.getNearbyStationWithArrival(this.currentID,this.currenCity);a&&(o.data=a)}});return R(()=>{"geolocation"in navigator&&navigator.geolocation.getCurrentPosition(a=>{const i=a.coords.latitude,n=a.coords.longitude;i&&n&&u.changeUserPosition(i,n)})}),W(v,async a=>{if(a){const i=await N.getNearbyStation(a[0],a[1]);i&&u.updateNearByStation(i)}}),(a,i)=>l(v)?(d(),m("section",Lt,[o.isShow?(d(),m("section",jt,[t("div",zt,[t("button",{type:"button",class:"flex-c",onClick:i[1]||(i[1]=(...n)=>o.closeShow&&o.closeShow(...n))},[b(O),t("span",Rt,c(l(h)("back")),1)])]),t("h3",Wt,c(l(p)==="zh-TW"?o.name:o.nameEn),1),t("div",Ut,[(d(!0),m(D,null,F(o.data,(n,_)=>(d(),$(At,{key:_,data:n},null,8,["data"]))),128))]),t("div",Ht,[t("div",Gt,[t("div",{class:B(["absolute left-0 h-[2px] bg-primary",{"process-line":s.autoMode}])},null,2)]),t("div",Ot,[t("input",{type:"checkbox",checked:s.autoMode,onChange:i[2]||(i[2]=(...n)=>s.toggleAutoMode&&s.toggleAutoMode(...n))},null,40,qt),t("span",Kt,c(l(h)("refreshAuto")),1),A(t("span",null,"\uFF08"+c(l(h)("afterTime"))+" "+c(s.timer)+" "+c(l(h)("second"))+"\uFF09",513),[[H,s.autoMode]])]),t("div",{class:"flex-c cursor-pointer",onClick:i[3]||(i[3]=(...n)=>s.updateData&&s.updateData(...n))},[b(q),t("span",Jt,c(l(h)("refreshNow")),1)])])])):(d(),m(D,{key:0},[t("div",Bt,[t("div",Et,[A(t("input",{"onUpdate:modelValue":i[0]||(i[0]=n=>f.value=n),type:"search",placeholder:l(h)("typeKeyword"),class:"peer w-full border-0 bg-transparent focus:ring-0"},null,8,Vt),[[U,f.value]]),b(G,{class:"absolute right-3 top-[50%] h-4 w-4 -translate-y-[50%] peer-hover:hidden peer-focus:hidden"})])]),t("div",Zt,[(d(!0),m(D,null,F(l(r),(n,_)=>(d(),$(gt,{key:_,data:n,index:_,onDisplayDetail:S=>{var g;return o.show(n.StationID,n.City,n.StationName.Zh_tw,(g=n.StationName.En)!=null?g:n.StationName.Zh_tw)}},null,8,["data","index","onDisplayDetail"]))),128))])],64))])):(d(),m("section",Ft,[b(ot,{class:"mr-2 h-6 w-6 animate-spin"}),E(" "+c(l(p)==="zh-TW"?"\u6B63\u5728\u53D6\u5F97\u60A8\u7684\u4F4D\u7F6E\u8CC7\u8A0A...":"Getting your location..."),1)]))}});export{ee as default};
